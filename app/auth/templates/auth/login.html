<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Login | SaasFX</title>
    <script>
        window.deferredInstallPrompt = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            window.deferredInstallPrompt = e;
            console.log('ðŸ“² beforeinstallprompt capturado');
        });
    </script>


    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS do sistema -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/paginas3.css') }}">

    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#0d6efd">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SaasFX">

    <link rel="apple-touch-icon" sizes="180x180" href="/static/images/apple-icon-180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/static/images/apple-icon-167.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/images/apple-icon-152.png">
    <style>
        /* ======================================================
           LOGIN â€“ PADRÃƒO VISUAL SAASFX
        ====================================================== */

        body {
            background: radial-gradient(circle at top, #0c2531, #05141b);
        }

        .login-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            width: 100%;
            max-width: 380px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 18px;
            padding: 32px 28px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            color: #ffffff;
        }

        .login-logo {
            max-width: 140px;
            margin: 0 auto 16px;
            display: block;
        }

        .login-title {
            text-align: center;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .login-subtitle {
            text-align: center;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 24px;
        }

        .login-card label {
            font-weight: 600;
            font-size: 0.9rem;
            color: #ffffff;
        }

        .login-card .btn-primary {
            background: linear-gradient(135deg, #00ffb4, #00c3ff);
            border: none;
            color: #003b32;
            font-weight: 700;
            border-radius: 12px;
            padding: 10px;
            margin-top: 8px;
        }

        .login-card .btn-primary:hover {
            opacity: 0.95;
        }

        .login-footer {
            text-align: center;
            margin-top: 18px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }
    </style>
</head>

<body>

    <div class="login-wrapper">
        <div class="login-card">

            <!-- Logo -->
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SaasFX" class="login-logo">

            <h2 class="login-title">SaasFX</h2>
            <div class="login-subtitle">Acesse sua conta</div>
            <button id="btnInstall" style="display:none; position:fixed; bottom:20px; left:20px; right:20px;
               padding:14px; font-size:16px; border-radius:14px;
               background:#0d6efd; color:white; border:none; z-index:9999;">
                ðŸ“² Instalar SaasFX
            </button>


            <!-- FormulÃ¡rio -->
            <form method="POST" action="{{ url_for('auth.login') }}">
                {{ form.hidden_tag() }}
                <input type="hidden" name="next" value="{{ request.args.get('next') }}">

                <div class="mb-3">
                    {{ form.email.label(class="form-label") }}
                    {{ form.email(class="form-control", placeholder="Digite seu e-mail") }}
                </div>

                <div class="mb-3">
                    {{ form.senha.label(class="form-label") }}
                    {{ form.senha(class="form-control", placeholder="Digite sua senha", type="password") }}
                </div>

                <button type="submit" class="btn btn-primary w-100">
                    Entrar
                </button>
            </form>

            <!-- Mensagens -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="mt-3">
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} mb-2">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <div class="login-footer">
                Â© {{ current_year if current_year else "2025" }} SaasFX
            </div>

        </div>
    </div>
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/static/service-worker.js");
        }
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const btn = document.getElementById("btnInstall");

            if (window.deferredInstallPrompt && btn) {
                btn.style.display = "block";
            }

            btn?.addEventListener("click", async () => {
                if (!window.deferredInstallPrompt) return;

                window.deferredInstallPrompt.prompt();
                await window.deferredInstallPrompt.userChoice;

                window.deferredInstallPrompt = null;
                btn.style.display = "none";
            });
        });
    </script>

</body>

</html>