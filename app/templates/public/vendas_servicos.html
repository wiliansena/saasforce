{% extends "base_mobile.html" %}

{% block title %}Comprar Servi√ßo{% endblock %}

{% block content %}

<h5 class="mb-3 fw-bold text-center">
    Comprar Servi√ßo
</h5>

<input type="text" id="pesquisaServico" class="form-control mb-3" placeholder="üîç Buscar servi√ßo...">

<div class="grid" id="listaServicos">

    {% for d in dados %}
    <div class="grid-item" data-nome="{{ d.servico.nome | lower }}">

        <div class="home-card">

            {% if d.servico.imagem %}
            <img src="{{ url_for('static', filename=d.servico.imagem) }}" alt="{{ d.servico.nome }}"
                style="max-height:70px; object-fit:contain; border-radius:12px;">
            {% else %}
            <i class="fas fa-tv"></i>
            {% endif %}

            <span class="fw-bold mt-1">
                {{ d.servico.nome }}
            </span>

            <div class="d-flex gap-2 mt-1 justify-content-center">
                {% if d.livres <= 5 %} <span class="fw-semibold text-danger small">
                    üî• √öltima chance
                    </span>
                    {% elif d.livres <= 15 %} <span class="fw-semibold text-warning small">
                        ‚è≥ Quase esgotado
                        </span>
                        {% else %}
                        <span class="fw-semibold text-white small">
                            üîê Acesso exclusivo
                        </span>
                        {% endif %}
            </div>
            
{% set preco = d.servico.valor_venda_padrao %}
{% set aumento = 20 %}

<div class="mt-2 text-center">

  <!-- Pre√ßo antigo -->
  <div style="color: rgba(255,255,255,0.5); 
              font-size: 0.85rem;
              text-decoration: line-through;">
    R$ {{ "%.2f"|format(preco * (100 + aumento) / 100) }}
  </div>

  <!-- Pre√ßo atual -->
  <div class="fw-bold" style="color: #22c55e; font-size: 1.4rem;">
    R$ {{ "%.2f"|format(preco) }}
  </div>

  <!-- Desconto -->
  <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem;">
    TODOS COM {{ aumento }}% OFF
  </div>

</div>


            {% if d.livres > 0 %}
            <a href="{{ url_for(
    'public.checkout_publico',
    slug=empresa.slug,
    servico_id=d.servico.id
) }}" class="btn btn-success w-100 mt-3 fw-bold">
                Garantir Acesso
            </a>

            {% else %}
            <button class="btn btn-secondary w-100 mt-3" disabled>
                Sem estoque
            </button>
            {% endif %}

        </div>

    </div>
    {% endfor %}

</div>

<script>
    const input = document.getElementById("pesquisaServico");
    const itens = document.querySelectorAll("#listaServicos .grid-item");

    input.addEventListener("input", function () {
        const termo = this.value.toLowerCase().trim();

        itens.forEach(item => {
            const nome = item.dataset.nome;
            item.style.display = nome.includes(termo) ? "" : "none";
        });
    });
</script>

{% endblock %}