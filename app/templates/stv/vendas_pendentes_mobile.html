{% extends "base_mobile.html" %}

{% block title %}Vendas Pendentes{% endblock %}

{% block content %}

<h5 class="text-center fw-bold mb-3">Vendas Pendentes</h5>

<!-- Voltar -->
<a href="{{ url_for('routes.home') }}"
   class="btn btn-outline-info w-100 mb-3">
  ← Voltar
</a>

<!-- BUSCA -->
<input type="text"
       id="busca"
       class="form-control mb-3"
       placeholder="Buscar por cliente, serviço, vendedor...">

{% if vendas_pendentes %}
<div class="d-flex flex-column gap-3" id="listaVendas">

  {% for venda in vendas_pendentes %}
  <div class="card p-3 venda-item">

    <!-- CLIENTE (principal) -->
    <div class="fw-bold fs-6 mb-1">
      {{ venda.cliente.nome }}
    </div>

    <!-- SERVIÇO (badge) -->
    <div class="mb-2">
      <span class="badge bg-info text-dark">
        {{ venda.servico.nome }}
      </span>
    </div>

    <!-- META INFORMAÇÕES -->
    <div class="d-flex flex-column gap-1 small text-muted">

      <div>
        <i class="bi bi-person-circle me-1"></i>
        <strong>Vendedor:</strong> {{ venda.vendedor.nome }}
      </div>

      <div>
        <i class="bi bi-calendar-event me-1"></i>
        {{ venda.data_venda.strftime('%d/%m/%Y %H:%M') if venda.data_venda }}
      </div>

    </div>

    <!-- AÇÃO -->
    <a href="{{ url_for('routes.stv_finalizar_venda', venda_id=venda.id) }}"
       class="btn btn-success w-100 fw-bold mt-3">
      Finalizar Venda
    </a>

  </div>
  {% endfor %}

</div>
{% else %}
<div class="alert alert-info text-center">
  Nenhuma venda pendente no momento.
</div>
{% endif %}

<!-- BUSCA JS -->
<script>
document.getElementById("busca").addEventListener("input", function () {
  const termo = this.value.toLowerCase();
  document.querySelectorAll(".venda-item").forEach(card => {
    const texto = card.innerText.toLowerCase();
    card.style.display = texto.includes(termo) ? "block" : "none";
  });
});
</script>

{% endblock %}
